<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Elephant Coffee ‚Äî ¬´–ü–æ–π–º–∞–π –ª–æ–≥–æ—Ç–∏–ø¬ª v2</title>
    <style>
        :root {
            --brand: #ffd7b3;
            /* —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ */
            --bg: #0f0f0f;
            /* —Ñ–æ–Ω –∏–≥—Ä–æ–≤–æ–π –∑–æ–Ω—ã */
            --text: #fff;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #111;
            color: var(--text)
        }

        .wrap {
            max-width: 980px;
            margin: 0 auto;
            padding: 16px
        }

        .card {
            background: #151515;
            border: 1px solid #222;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, .35);
            overflow: hidden
        }

        .header {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid #222;
            background: linear-gradient(180deg, #181818, #141414)
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .brand img {
            width: 36px;
            height: 36px;
            object-fit: contain
        }

        .brand h1 {
            font-size: 18px;
            margin: 0;
            letter-spacing: .3px
        }

        .hud {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center
        }

        .pill {
            background: #1f1f1f;
            border: 1px solid #2a2a2a;
            border-radius: 999px;
            padding: 8px 12px;
            font-weight: 600
        }

        .pill strong {
            color: var(--brand)
        }

        .btn {
            appearance: none;
            border: none;
            background: var(--brand);
            color: #111;
            font-weight: 800;
            border-radius: 999px;
            padding: 10px 18px;
            cursor: pointer;
            transition: transform .08s ease, box-shadow .2s ease;
            box-shadow: 0 6px 20px rgba(255, 215, 179, .35)
        }

        .btn:hover {
            transform: translateY(-1px)
        }

        .btn:active {
            transform: translateY(0)
        }

        .btn[disabled] {
            opacity: .6;
            cursor: not-allowed;
            filter: grayscale(.2)
        }

        .select {
            appearance: none;
            background: #1f1f1f;
            border: 1px solid #2a2a2a;
            color: #eee;
            border-radius: 12px;
            padding: 8px 12px;
            font-weight: 700
        }

        /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        #game {
            position: relative;
            height: min(70vh, 720px);
            min-height: 420px;
            background: var(--bg) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600" viewBox="0 0 600 600"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="90" fill="rgba(255,255,255,0.03)">ELEPHANT</text></svg>') center/contain no-repeat;
            border-top: 1px solid #202020;
            overflow: hidden
        }

        .grid {
            position: absolute;
            inset: 0;
            background-image: radial-gradient(rgba(255, 255, 255, .04) 1px, transparent 1px);
            background-size: 24px 24px;
            pointer-events: none
        }

        .logo {
            position: absolute;
            top: -80px;
            width: 72px;
            height: 72px;
            object-fit: contain;
            cursor: pointer;
            user-select: none;
            will-change: transform;
            filter: drop-shadow(0 6px 10px rgba(0, 0, 0, .5));
        }

        .gold {
            filter: drop-shadow(0 6px 14px rgba(255, 215, 0, .55)) saturate(1.2) hue-rotate(12deg)
        }

        @keyframes fall {
            to {
                transform: translateY(calc(100vh + 120px)) rotate(var(--rot-end, 360deg));
            }
        }

        @keyframes pop {
            0% {
                transform: scale(1);
                opacity: 1
            }

            80% {
                transform: scale(1.25);
                opacity: .9
            }

            100% {
                transform: scale(.6);
                opacity: 0
            }
        }

        /* –î–æ–∂–¥—å –∑—ë—Ä–µ–Ω (–¥–µ–∫–æ—Ä) */
        .beans {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden
        }

        .bean {
            position: absolute;
            top: -20px;
            width: 10px;
            height: 16px;
            border-radius: 50%/60% 60% 40% 40%;
            background: #2b1b12;
            opacity: .18;
            animation: beanFall linear infinite;
            transform: rotate(20deg)
        }

        @keyframes beanFall {
            to {
                transform: translateY(110%) rotate(380deg)
            }
        }

        /* –û–≤–µ—Ä–ª–µ–∏ */
        .overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(0, 0, 0, .55), rgba(0, 0, 0, .65));
            backdrop-filter: blur(2px)
        }

        .modal {
            background: #141414;
            border: 1px solid #272727;
            border-radius: 16px;
            padding: 16px 18px;
            box-shadow: 0 14px 40px rgba(0, 0, 0, .5);
            max-width: 92%;
            text-align: center
        }

        .footer {
            padding: 12px 16px;
            border-top: 1px solid #222;
            display: flex;
            justify-content: space-between;
            gap: 8px;
            flex-wrap: wrap;
            color: #bdbdbd;
            font-size: 14px
        }

        .footer code {
            background: #1b1b1b;
            border: 1px solid #262626;
            border-radius: 8px;
            padding: 2px 6px
        }

        .coupon {
            display: inline-flex;
            gap: 8px;
            align-items: center;
            background: #1b1b1b;
            border: 1px dashed #444;
            padding: 6px 10px;
            border-radius: 10px
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="card">
            <div class="header">
                <div class="brand">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/3f/OOjs_UI_icon_heart.svg" alt="logo" />
                    <h1>–ú–∏–Ω–∏‚Äë–∏–≥—Ä–∞ ¬´–ü–æ–π–º–∞–π –ª–æ–≥–æ—Ç–∏–ø¬ª ‚Äî Elephant Coffee v2</h1>
                </div>
                <div class="hud">
                    <label class="pill" title="–°–ª–æ–∂–Ω–æ—Å—Ç—å –≤–ª–∏—è–µ—Ç –Ω–∞ —á–∞—Å—Ç–æ—Ç—É —Å–ø–∞–≤–Ω–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è">
                        –°–ª–æ–∂–Ω–æ—Å—Ç—å:
                        <select id="difficulty" class="select">
                            <option value="easy">Easy</option>
                            <option value="normal" selected>Normal</option>
                            <option value="hard">Hard</option>
                        </select>
                    </label>
                    <div class="pill">–í—Ä–µ–º—è: <strong id="time">10.0</strong> c</div>
                    <div class="pill">–°—á—ë—Ç: <strong id="score">0</strong></div>
                    <button id="start" class="btn">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>

            <div id="game">
                <div class="grid"></div>
                <div class="beans" aria-hidden="true" id="beans"></div>
            </div>

            <div class="footer">
                <div>
                    –õ–æ–≤–∏ –ª–æ–≥–æ—Ç–∏–ø—ã –∑–∞ 10 —Å–µ–∫—É–Ω–¥. –û–±—ã—á–Ω—ã–π = +1, <b>–∑–æ–ª–æ—Ç–æ–π</b> = +5. –°–∫–∏–¥–∫–∞ = <b>—Å—á—ë—Ç%</b> (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
                    —Å–≤–µ—Ä—Ö—É).
                </div>
                <div>
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏: <code>IMG_SRC</code>, <code>GAME_DURATION_MS</code>, <code>MAX_DISCOUNT_PERCENT</code>.
                </div>
            </div>
        </div>
    </div>

    <script>
        // ----------------------
        // ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´
        // ----------------------
        const GAME_DURATION_MS = 10_000;      // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã (–º—Å)
        const MAX_DISCOUNT_PERCENT = 100;       // –º–∞–∫—Å–∏–º—É–º —Å–∫–∏–¥–∫–∏

        // –ü—É—Ç—å –∫ —Ç–≤–æ–µ–º—É –ª–æ–≥–æ—Ç–∏–ø—É (PNG/SVG). –° —É—á—ë—Ç–æ–º —Ç–≤–æ–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ‚Äî —Ñ–∞–π–ª —Ä—è–¥–æ–º —Å index.html
        const IMG_SRC = './imageedit_4_5417855534.png';

        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—è–º
        const DIFF = {
            easy: { spawn: 520, fall: [3200, 5600], goldenChance: 0.05 },
            normal: { spawn: 420, fall: [2600, 5000], goldenChance: 0.08 },
            hard: { spawn: 320, fall: [2000, 4200], goldenChance: 0.12 },
        };

        const GOLD_BONUS = 5; // –æ—á–∫–æ–≤ –∑–∞ –∑–æ–ª–æ—Ç–æ–π –ª–æ–≥–æ—Ç–∏–ø

        // ----------------------
        // üîä –ú–Ø–ì–ö–ò–ô –ó–í–£–ö ¬´–ø–æ–ø¬ª (Web Audio)
        // ----------------------
        let audioCtx = null;
        function clickPop() {
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.type = 'triangle';
                o.frequency.setValueAtTime(880, audioCtx.currentTime);
                o.frequency.exponentialRampToValueAtTime(220, audioCtx.currentTime + 0.12);
                g.gain.value = 0.08; // –≥—Ä–æ–º–∫–æ—Å—Ç—å
                g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.14);
                o.connect(g).connect(audioCtx.destination);
                o.start(); o.stop(audioCtx.currentTime + 0.15);
            } catch (e) { }
        }

        // ----------------------
        // üß† –õ–û–ì–ò–ö–ê
        // ----------------------
        const game = document.getElementById('game');
        const btnStart = document.getElementById('start');
        const timeEl = document.getElementById('time');
        const scoreEl = document.getElementById('score');
        const beansLayer = document.getElementById('beans');
        const difficultySel = document.getElementById('difficulty');

        let running = false;
        let score = 0;
        let t0 = 0;
        let timerRaf = null;
        let spawnInt = null;
        let params = DIFF[difficultySel.value];

        difficultySel.addEventListener('change', () => { params = DIFF[difficultySel.value]; });

        function rand(min, max) { return Math.random() * (max - min) + min }
        function clamp(n, a, b) { return Math.max(a, Math.min(b, n)) }

        function spawnLogo() {
            const rect = game.getBoundingClientRect();
            const el = new Image();
            el.src = IMG_SRC;
            el.decoding = 'async';
            el.className = 'logo';

            // –∑–æ–ª–æ—Ç–æ–π?
            const isGold = Math.random() < params.goldenChance;
            if (isGold) el.classList.add('gold');

            const size = clamp(rand(56, 96), 52, 110);
            el.style.width = size + 'px';
            el.style.height = size + 'px';
            const x = rand(0, Math.max(0, rect.width - size));
            el.style.left = x + 'px';

            const rotEnd = (Math.random() < 0.5 ? -1 : 1) * rand(200, 520) + 'deg';
            el.style.setProperty('--rot-end', rotEnd);

            const fallMs = rand(params.fall[0], params.fall[1]);
            el.style.animation = `fall ${fallMs}ms linear forwards`;

            const catchHandler = (e) => {
                if (!running) return; e.stopPropagation();
                score += isGold ? GOLD_BONUS : 1;
                scoreEl.textContent = String(score);
                clickPop();
                el.style.animation = 'pop 280ms ease-out forwards';
                el.style.pointerEvents = 'none';
                setTimeout(() => el.remove(), 280);
            };
            el.addEventListener('click', catchHandler, { passive: true });
            el.addEventListener('touchstart', catchHandler, { passive: true });

            el.addEventListener('animationend', () => el.remove(), { once: true });
            game.appendChild(el);
        }

        function startGame() {
            if (running) return;
            running = true; score = 0; scoreEl.textContent = '0';
            btnStart.disabled = true;
            [...game.querySelectorAll('.logo')].forEach(n => n.remove());

            // –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç 3..2..1
            countdown(3).then(() => {
                t0 = performance.now();
                const tick = (now) => {
                    const elapsed = now - t0;
                    const left = clamp((GAME_DURATION_MS - elapsed) / 1000, 0, GAME_DURATION_MS / 1000);
                    timeEl.textContent = left.toFixed(1);
                    if (elapsed < GAME_DURATION_MS && running) {
                        timerRaf = requestAnimationFrame(tick);
                    } else { endGame(); }
                };
                timerRaf = requestAnimationFrame(tick);
                spawnInt = setInterval(spawnLogo, params.spawn);
            });
        }

        function endGame() {
            running = false;
            cancelAnimationFrame(timerRaf);
            clearInterval(spawnInt);
            timeEl.textContent = '0.0';
            [...game.querySelectorAll('.logo')].forEach(n => { n.style.pointerEvents = 'none'; });

            const discount = clamp(score, 0, MAX_DISCOUNT_PERCENT);
            const code = makeCoupon(discount);

            showResult(discount, code);
            btnStart.disabled = false;
        }

        function toast(text) {
            const t = document.createElement('div');
            t.textContent = text;
            Object.assign(t.style, { position: 'absolute', left: '50%', top: '16px', transform: 'translateX(-50%)', background: 'rgba(0,0,0,.8)', border: '1px solid #333', color: '#fff', padding: '10px 14px', borderRadius: '12px', fontWeight: '700', boxShadow: '0 8px 24px rgba(0,0,0,.45)', zIndex: 5 });
            game.appendChild(t);
            setTimeout(() => { t.style.transition = 'all .35s ease'; t.style.opacity = '0'; t.style.transform = 'translateX(-50%) translateY(-8px)'; setTimeout(() => t.remove(), 380); }, 1200);
        }

        function countdown(seconds) {
            return new Promise(resolve => {
                const ov = document.createElement('div');
                ov.className = 'overlay';
                const md = document.createElement('div'); md.className = 'modal';
                const txt = document.createElement('div'); txt.style.fontSize = '64px'; txt.style.fontWeight = '900'; txt.textContent = seconds;
                md.appendChild(txt); ov.appendChild(md); game.appendChild(ov);
                let n = seconds;
                const id = setInterval(() => {
                    n--; txt.textContent = n > 0 ? n : 'Go!'; clickPop();
                    if (n <= 0) {
                        clearInterval(id);
                        setTimeout(() => { ov.remove(); resolve(); }, 450);
                    }
                }, 1000);
            });
        }

        function showResult(discount, code) {
            const ov = document.createElement('div'); ov.className = 'overlay';
            const md = document.createElement('div'); md.className = 'modal';
            md.innerHTML = `
        <h2 style="margin:.2rem 0 0;font-size:28px">–ò—Ç–æ–≥</h2>
        <p style="opacity:.85;margin:.2rem 0 .6rem">–¢–≤–æ–π —Å—á—ë—Ç: <b>${score}</b> ‚Üí –°–∫–∏–¥–∫–∞: <b>${discount}%</b></p>
        <div class="coupon"><span id="couponText">${code}</span><button class="btn" id="copyBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
          <button class="btn" id="againBtn">–ï—â—ë —Ä–∞–∑</button>
          <button class="btn" id="closeBtn" style="background:#eaeaea">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>`;
            ov.appendChild(md); game.appendChild(ov);
            md.querySelector('#copyBtn').addEventListener('click', async () => {
                const text = md.querySelector('#couponText').textContent; try { await navigator.clipboard.writeText(text); toast('–ö—É–ø–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω'); } catch (e) { toast('–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é'); }
            });
            md.querySelector('#againBtn').addEventListener('click', () => { ov.remove(); startGame(); });
            md.querySelector('#closeBtn').addEventListener('click', () => ov.remove());
        }

        function makeCoupon(discount) {
            // –§–æ—Ä–º–∞—Ç: ELEPHANT-<DD>-<4 random>
            const rand4 = Math.random().toString(36).slice(2, 6).toUpperCase();
            const dd = String(discount).padStart(2, '0');
            return `ELEPHANT-${dd}-${rand4}`;
        }

        // –î–µ–∫–æ—Ä: –¥–æ–∂–¥—å –∑—ë—Ä–µ–Ω
        function spawnBeans() {
            const w = game.clientWidth; const count = Math.floor(w / 42);
            beansLayer.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const b = document.createElement('div'); b.className = 'bean';
                b.style.left = Math.random() * 100 + '%';
                const d = 3500 + Math.random() * 3500; b.style.animationDuration = d + 'ms';
                b.style.opacity = 0.12 + Math.random() * 0.12;
                beansLayer.appendChild(b);
            }
        }
        window.addEventListener('resize', spawnBeans);
        spawnBeans();

        btnStart.addEventListener('click', startGame);
        game.addEventListener('click', () => { if (!running) startGame(); });

        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏
        const pre = new Image(); pre.src = IMG_SRC;
    </script>
</body>

</html>
<!doctype html>
<html lang="pl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Elephant Coffee ‚Äî Gra</title>
    <style>
        :root {
            --brand: #ffd7b3;
            --gold: #ffd700;
            --text: #fff;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            background: #000;
            color: var(--text);
            font-family: Inter, system-ui, sans-serif;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #0f0f0f;
        }

        /* Pasek statusu */
        .safe {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 14px;
            padding-top: calc(env(safe-area-inset-top) + 14px);
            display: flex;
            justify-content: space-between;
            z-index: 5;
            font-weight: 700;
        }

        .pill {
            background: rgba(0, 0, 0, .45);
            border: 1px solid #333;
            border-radius: 999px;
            padding: 6px 12px;
        }

        /* Obiekty gry */
        .logo,
        .super,
        .bomb,
        .big,
        .tornado {
            position: absolute;
            top: -80px;
            width: 56px;
            height: 56px;
            /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            object-fit: contain;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            will-change: transform, left, top;
            filter: brightness(1.12) contrast(1.06) drop-shadow(0 10px 14px rgba(0, 0, 0, .65));
        }

        .super {
            border-radius: 50%;
            box-shadow: 0 0 0 3px var(--gold), 0 0 14px var(--gold), 0 0 22px rgba(255, 215, 0, .35);
        }

        .bomb {
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 10px 14px rgba(0, 0, 0, .65));
        }

        .big {
            width: 180px;
            height: 180px;
            filter: drop-shadow(0 10px 18px rgba(0, 0, 0, .55)) drop-shadow(0 0 14px rgba(255, 215, 179, .25));
        }

        .emoji {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
        }

        /* –ü–∞–¥–µ–Ω–∏–µ + –ª—ë–≥–∫–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ */
        @keyframes fall {
            to {
                transform: translateY(calc(100vh + 140px)) rotate(var(--rot, 0deg));
            }
        }

        @keyframes tilt {
            0% {
                transform: rotate(-6deg)
            }

            50% {
                transform: rotate(6deg)
            }

            100% {
                transform: rotate(-6deg)
            }
        }

        /* –Ω–∞–∑–Ω–∞—á–∞–µ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–∞–¥–µ–Ω–∏–µ –∏ –∫–∞—á–∞–Ω–∏–µ */
        .logo,
        .super {
            animation-name: fall, tilt;
            animation-duration: var(--fallDur, 2000ms), 2.2s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: 1, infinite;
        }

        .big {
            animation-name: fall, tilt;
            animation-duration: var(--fallDur, 2200ms), 2.4s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: 1, infinite;
        }

        /* Overlay start */
        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, .65);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .modal {
            text-align: center;
            max-width: 90%;
        }

        .btn {
            background: var(--brand);
            border: none;
            border-radius: 999px;
            padding: 12px 24px;
            font-weight: 800;
            cursor: pointer;
        }

        /* Arkusz ko≈Ñcowy */
        .sheet {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            background: #111;
            padding: 20px;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
            z-index: 20;
            box-shadow: 0 -12px 30px rgba(0, 0, 0, .4);
        }

        .coupon {
            background: #1b1b1b;
            border: 1px dashed #555;
            padding: 8px 12px;
            border-radius: 10px;
            display: inline-flex;
            gap: 8px;
        }

        /* Klik ‚Äì pier≈õcie≈Ñ + konfetti + label */
        .ring {
            position: absolute;
            width: 14px;
            height: 14px;
            border: 3px solid var(--brand);
            border-radius: 999px;
            pointer-events: none;
            opacity: .9;
            transform: translate(-50%, -50%) scale(.3);
            animation: ring .5s ease-out forwards;
        }

        @keyframes ring {
            to {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.8);
            }
        }

        .float {
            position: absolute;
            left: 0;
            top: 0;
            transform: translate(-50%, -50%);
            color: var(--gold);
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(0, 0, 0, .5);
            pointer-events: none;
            animation: floatUp .9s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 0;
                transform: translate(-50%, -30%) scale(.6)
            }

            20% {
                opacity: 1
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -120%) scale(1.1)
            }
        }

        .confetti {
            position: absolute;
            width: 8px;
            height: 12px;
            border-radius: 5px;
            pointer-events: none;
            animation: confDrop 1s ease-out forwards;
        }

        @keyframes confDrop {
            to {
                transform: translate(var(--dx), var(--dy)) rotate(var(--rot));
                opacity: 0;
            }
        }

        /* Eksplozja */
        .boom {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 70%;
            pointer-events: none;
            background: radial-gradient(circle, rgba(255, 220, 150, .95) 0%, rgba(255, 120, 0, .7) 45%, rgba(0, 0, 0, 0) 70%);
            transform: translate(-50%, -50%) scale(.5);
            opacity: .95;
            box-shadow: 0 0 20px rgba(255, 140, 0, .8), 0 0 40px rgba(255, 100, 0, .6);
            animation: boom 1s ease-out forwards;
        }

        @keyframes boom {
            60% {
                transform: translate(-50%, -50%) scale(8);
                opacity: .85;
            }

            100% {
                transform: translate(-50%, -50%) scale(8);
                opacity: 0;
            }
        }

        /* WstrzƒÖs ekranu + wiatr */
        .shake {
            animation: shake 450ms cubic-bezier(.36, .07, .19, .97);
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate(-1px, 0)
            }

            20%,
            80% {
                transform: translate(2px, 0)
            }

            30%,
            50%,
            70% {
                transform: translate(-4px, 0)
            }

            40%,
            60% {
                transform: translate(4px, 0)
            }
        }

        .wind {
            animation: wind .45s ease-in-out;
        }

        @keyframes wind {
            0% {
                transform: translateX(0)
            }

            25% {
                transform: translateX(-6px)
            }

            50% {
                transform: translateX(6px)
            }

            75% {
                transform: translateX(-3px)
            }

            100% {
                transform: translateX(0)
            }
        }

        /* === –ö–†–ò–¢-—ç—Ñ—Ñ–µ–∫—Ç—ã === */
        .crit-flash {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, .14), rgba(255, 255, 255, 0) 60%);
            pointer-events: none;
            animation: critFlash .35s ease-out forwards;
            z-index: 9;
        }

        @keyframes critFlash {
            from {
                opacity: .9
            }

            to {
                opacity: 0
            }
        }

        .crit-burst {
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 999px;
            background: radial-gradient(circle, rgba(255, 215, 179, .95) 0%, rgba(255, 200, 120, .65) 45%, rgba(0, 0, 0, 0) 70%);
            box-shadow: 0 0 30px rgba(255, 200, 120, .9), 0 0 60px rgba(255, 160, 60, .7);
            transform: translate(-50%, -50%) scale(.6);
            opacity: .95;
            pointer-events: none;
            z-index: 8;
            animation: critBurst .7s ease-out forwards;
        }

        @keyframes critBurst {
            60% {
                transform: translate(-50%, -50%) scale(10);
                opacity: .85;
            }

            100% {
                transform: translate(-50%, -50%) scale(10);
                opacity: 0;
            }
        }

        .crit-ray {
            position: absolute;
            width: 6px;
            height: 26px;
            border-radius: 3px;
            background: linear-gradient(to bottom, rgba(255, 215, 179, 1), rgba(255, 215, 179, 0));
            transform-origin: center bottom;
            opacity: .95;
            pointer-events: none;
            z-index: 8;
            animation: critRay .7s ease-out forwards;
        }

        @keyframes critRay {
            60% {
                transform: translate(-50%, -50%) rotate(var(--rot)) scaleY(1.5);
                opacity: .9;
            }

            100% {
                transform: translate(-50%, -50%) rotate(var(--rot)) scaleY(1.5) translateY(-24px);
                opacity: 0;
            }
        }

        /* === üåÄ Tornado === */
        .tornado {
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fall var(--fallDur, 2200ms) linear forwards, spin 1.2s linear infinite, spawnFade .25s ease-out forwards;
            filter: drop-shadow(0 0 12px rgba(150, 200, 255, .6));
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes spawnFade {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .twist {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 6px solid rgba(160, 200, 255, .85);
            opacity: .9;
            transform: translate(-50%, -50%) scale(.9);
            pointer-events: none;
            animation: twistOut .55s ease-out forwards;
            box-shadow: 0 0 10px rgba(140, 190, 255, .7);
        }

        @keyframes twistOut {
            70% {
                transform: translate(var(--dx), var(--dy)) scale(1.35);
                opacity: .7;
            }

            100% {
                transform: translate(var(--dx), var(--dy)) scale(1.35);
                opacity: 0;
            }
        }

        .vortex {
            position: absolute;
            left: 0;
            top: 0;
            pointer-events: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, rgba(170, 210, 255, .25), rgba(170, 210, 255, 0) 65%);
            box-shadow: 0 0 22px rgba(150, 200, 255, .45), inset 0 0 14px rgba(180, 220, 255, .35);
            transform: translate(-50%, -50%) scale(.6) rotate(0deg);
            animation: vortexSpin .6s ease-out forwards;
        }

        @keyframes vortexSpin {
            60% {
                transform: translate(-50%, -50%) scale(2.8) rotate(220deg);
                opacity: .9;
            }

            100% {
                transform: translate(-50%, -50%) scale(3.0) rotate(260deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div class="app" id="app">
        <div class="safe">
            <div class="pill">Czas: <b id="time">15.0</b>s</div>
            <div class="pill">Rabat: <b id="discount">0</b>%</div>
        </div>
        <div class="overlay" id="startOv">
            <div class="modal">
                <h1 style="font-size:28px;font-weight:900;">Z≈Çap S≈Çonia</h1>
                <p style="opacity:.9;line-height:1.4">
                   ‚Ä¢ S≈Ço≈Ñ = <b>+0.2%</b><br> ‚Ä¢ Super S≈Ço≈Ñ = <b>+0.7%</b><br> ‚Ä¢ Du≈ºa paczka = <b>+0.8%</b><br>
                    üí£ Bomba = <b>‚àí3%</b><br> ‚Ä¢ Zestaw trzech kaw = <b>‚àí0.4%</b><br> üéÅüêòüî•
                </p>
                <button class="btn" id="start">Graj!</button>
            </div>
        </div>
    </div>

    <script>
        /* ===========================
              üêò –ù–ê–°–¢–†–û–ô–ö–ò (–º–µ–Ω—è–π)
           =========================== */

        /* --- –í–†–ï–ú–Ø –†–ê–£–ù–î–ê --- */
        const GAME_DURATION = 15000;      // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã, –º—Å

        /* --- –°–ü–ê–í–ù / –ü–ê–î–ï–ù–ò–ï --- */
        const SPAWN_INTERVAL = 80;       // –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–ø–∞–≤–Ω–∞ (–º–µ–Ω—å—à–µ ‚Üí –≥—É—â–µ)
        const FALL_MIN = 1800;            // –º–∏–Ω. –≤—Ä–µ–º—è –ø–∞–¥–µ–Ω–∏—è, –º—Å
        const FALL_MAX = 2800;            // –º–∞–∫—Å. –≤—Ä–µ–º—è –ø–∞–¥–µ–Ω–∏—è, –º—Å
        const CH_SWIM = 0.35;             // —à–∞–Ω—Å ¬´–ø–ª–∞–≤–∞–Ω–∏—è¬ª
        const CH_EVADE = 0.26;            // —à–∞–Ω—Å —É–≤–µ—Ä–Ω—É—Ç—å—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏/—Ç–∞–ø–µ

        /* --- –í–ï–†–û–Ø–¢–ù–û–°–¢–ò (–≤ —Å—É–º–º–µ ‚â§ 1) --- */
        const CH_SUPER = 0.20;          // —Å—É–ø–µ—Ä-—Å–ª–æ–Ω (–Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –∑–∞ —Ä–∞—É–Ω–¥)
        const CH_BIG = 0.1;          // –±–æ–ª—å—à–æ–π —Å–ª–æ–Ω
        const CH_BOMB = 0.08;          // –±–æ–º–±–∞
        const CH_TORNADO = 0.05;          // —Ç–æ—Ä–Ω–∞–¥–æ
        // –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –æ–±—ã—á–Ω—ã–µ —Å–ª–æ–Ω—ã

        /* --- –ù–ê–ì–†–ê–î–´ / –®–¢–†–ê–§–´ --- */
        const HIT_NORMAL = 0.2;           // +% –∑–∞ —Å–ª–æ–Ω–∞
        const HIT_SUPER = 0.7;           // +% –∑–∞ —Å—É–ø–µ—Ä-—Å–ª–æ–Ω–∞
        const HIT_BIG = 0.5;           // +% –∑–∞ –±–æ–ª—å—à–æ–≥–æ
        const HIT_BOMB = -3.0;          // ‚àí% –∑–∞ –±–æ–º–±—É
        const HIT_TORNADO = -0.4;          // ‚àí% –∑–∞ —Ç–æ—Ä–Ω–∞–¥–æ
        const MAX_RABAT = 10;            // –ø—Ä–µ–¥–µ–ª —Å–∫–∏–¥–∫–∏

        /* --- –í–ò–ë–†–ê–¶–ò–ò --- */
        const VIB_NORMAL = 18;
        const VIB_SUPER = 26;
        const VIB_BOMB_V = [80, 40, 120];
        const VIB_TORNADO = [40, 20, 60];

        /* --- –ú–£–ó–´–ö–ê/–ó–í–£–ö --- */
        const BG_VOLUME = 0.35;
        const SRC_BG = "background.mp3";        // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
        const SRC_HIT = "Elephant Cofee.mp3";    // –∫–æ—Ä–æ—Ç–∫–∏–π –∫–ª–∏–∫ (50‚Äì150–º—Å)
        const SRC_BOMB = "bomb.mp3";              // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

        /* --- –õ–û–ì–û–¢–ò–ü --- */
        const LOGO_SRC = "logo.png";  // –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª
        // –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ñ–æ–ª–±—ç–∫ (SVG-–∫—Ä—É–∂–æ–∫ –≤ —Ü–≤–µ—Ç–µ –±—Ä–µ–Ω–¥–∞)
        const LOGO_FALLBACK = "data:image/svg+xml;utf8," + encodeURIComponent(
            `<svg xmlns='http://www.w3.org/2000/svg' width='56' height='56'>
        <circle cx='28' cy='28' r='26' fill='#ffd7b3'/>
      </svg>`
        );

        /* ===========================
                    CONST/STATE
           =========================== */
        const NORMAL = HIT_NORMAL, SUPER = HIT_SUPER, BOMB = HIT_BOMB, CAP = MAX_RABAT;
        const BOMB_ICON = "üí£";
        const LOGO_BIG = "./big.png"; 

        let running = false, discount = 0, superDone = false, bigCount = 0, t0 = 0, spawnTimer = null;
        const app = document.getElementById('app'),
            dEl = document.getElementById('discount'),
            tEl = document.getElementById('time'),
            startOv = document.getElementById('startOv');

        const pct = v => v.toFixed(1) + '%';
        const vibr = p => { if (navigator.vibrate) try { navigator.vibrate(p) } catch (e) { } };
        const rand = (a, b) => Math.random() * (b - a) + a;
        const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

        /* –§–æ–Ω: –º—É–∑—ã–∫–∞ */
        const bgMusic = new Audio(SRC_BG); bgMusic.loop = true; bgMusic.volume = BG_VOLUME;

        /* –ü—É–ª –∫–ª–∏–∫–æ–≤ –ø–æ —Å–ª–æ–Ω—É (–±–µ–∑ –ª–∞–≥–æ–≤) */
        const HIT_POOL_SIZE = 6;
        const hitPool = Array.from({ length: HIT_POOL_SIZE }, () => { const a = new Audio(SRC_HIT); a.preload = "auto"; a.volume = 0.45; return a; });
        let hitIdx = 0;
        function playHit() { const a = hitPool[hitIdx++ % HIT_POOL_SIZE]; try { a.currentTime = 0; a.play(); } catch (_) { } }

        /* –ë–æ–º–±–∞: –æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–≤—É–∫ */
        let sndBomb = null; try { sndBomb = new Audio(SRC_BOMB); sndBomb.preload = "auto"; sndBomb.volume = 0.7; } catch (_) { sndBomb = null; }
        function playBomb() { if (!sndBomb) return; try { sndBomb.currentTime = 0; sndBomb.play(); } catch (_) { } }

        /* –§–∞–±—Ä–∏–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ–Ω–∞ —Å —Ñ–æ–ª–±—ç–∫–æ–º */
        function makeElephantImg() {
            const img = new Image();
            img.decoding = 'async';
            img.loading = 'eager';
            img.src = LOGO_SRC;
            img.onerror = () => { img.onerror = null; img.src = LOGO_FALLBACK; };
            return img;
        }

        /* UI —ç—Ñ—Ñ–µ–∫—Ç—ã */
        function ring(x, y) { const r = document.createElement('div'); r.className = 'ring'; r.style.left = x + 'px'; r.style.top = y + 'px'; app.appendChild(r); setTimeout(() => r.remove(), 520); }
        function confetti(x, y, amount = 14) {
            const colors = ['#ffd7b3', '#ffd700', '#ffa84d', '#ffffff'];
            for (let i = 0; i < amount; i++) {
                const c = document.createElement('div'); c.className = 'confetti';
                c.style.left = x + 'px'; c.style.top = y + 'px'; c.style.background = colors[Math.floor(Math.random() * colors.length)];
                const dx = (Math.random() < 0.5 ? -1 : 1) * (20 + Math.random() * 60);
                const dy = -(20 + Math.random() * 60);
                const rot = (Math.random() < 0.5 ? -1 : 1) * (120 + Math.random() * 180) + 'deg';
                c.style.setProperty('--dx', dx + 'px'); c.style.setProperty('--dy', dy + 'px'); c.style.setProperty('--rot', rot);
                app.appendChild(c); setTimeout(() => c.remove(), 1000);
            }
        }
        function floatLabel(x, y, text) { const f = document.createElement('div'); f.className = 'float'; f.textContent = text; f.style.left = x + 'px'; f.style.top = y + 'px'; app.appendChild(f); setTimeout(() => f.remove(), 900); }
        const celebrate = (x, y, text) => { ring(x, y); confetti(x, y); floatLabel(x, y, text); };
        function boom(x, y) { const b = document.createElement('div'); b.className = 'boom'; b.style.left = x + 'px'; b.style.top = y + 'px'; app.appendChild(b); setTimeout(() => b.remove(), 650); }
        function shake() { app.classList.remove('shake'); void app.offsetWidth; app.classList.add('shake'); }
        function windGust() { app.classList.remove('wind'); void app.offsetWidth; app.classList.add('wind'); }

        /* –ö—Ä–∏—Ç-—ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Å—É–ø–µ—Ä-—Å–ª–æ–Ω–∞ */
        const CRIT_CONFETTI = 28, CRIT_RAYS = 10, CRIT_VIB = 40;
        function confettiRich(x, y, amount = 24) {
            const colors = ['#ffd7b3', '#ffd700', '#ffa84d', '#fff5da', '#ffffff'];
            for (let i = 0; i < amount; i++) {
                const c = document.createElement('div'); c.className = 'confetti';
                c.style.left = x + 'px'; c.style.top = y + 'px'; c.style.background = colors[Math.floor(Math.random() * colors.length)];
                const dx = (Math.random() < 0.5 ? -1 : 1) * (30 + Math.random() * 80);
                const dy = -(30 + Math.random() * 80);
                const rot = (Math.random() < 0.5 ? -1 : 1) * (140 + Math.random() * 220) + 'deg';
                c.style.setProperty('--dx', dx + 'px'); c.style.setProperty('--dy', dy + 'px'); c.style.setProperty('--rot', rot);
                app.appendChild(c); setTimeout(() => c.remove(), 1000);
            }
        }
        function critCelebrate(x, y, text) {
            ring(x, y); confettiRich(x, y, CRIT_CONFETTI); floatLabel(x, y, text || ('+' + pct(SUPER)));
            const b = document.createElement('div'); b.className = 'crit-burst'; b.style.left = x + 'px'; b.style.top = y + 'px'; app.appendChild(b); setTimeout(() => b.remove(), 720);
            for (let i = 0; i < CRIT_RAYS; i++) {
                const r = document.createElement('div'); r.className = 'crit-ray'; r.style.left = x + 'px'; r.style.top = y + 'px';
                const base = (360 / CRIT_RAYS) * i, jitter = (Math.random() * 18) - 9; r.style.setProperty('--rot', (base + jitter) + 'deg');
                app.appendChild(r); setTimeout(() => r.remove(), 720);
            }
            const f = document.createElement('div'); f.className = 'crit-flash'; app.appendChild(f); setTimeout(() => f.remove(), 360);
        }

        /* üåÄ –í–∏—Ö—Ä—å —ç—Ñ—Ñ–µ–∫—Ç—ã */
        function twistBurst(x, y, n = 8) {
            for (let i = 0; i < n; i++) {
                const t = document.createElement('div'); t.className = 'twist';
                t.style.left = x + 'px'; t.style.top = y + 'px';
                const angle = (Math.PI * 2 / n) * i + (Math.random() * 0.6 - 0.3);
                const r = 26 + Math.random() * 24;
                t.style.setProperty('--dx', (Math.cos(angle) * r) + 'px');
                t.style.setProperty('--dy', (Math.sin(angle) * r) + 'px');
                app.appendChild(t); setTimeout(() => t.remove(), 560);
            }
        }
        function vortex(x, y) { const v = document.createElement('div'); v.className = 'vortex'; v.style.left = x + 'px'; v.style.top = y + 'px'; app.appendChild(v); setTimeout(() => v.remove(), 620); }

        /* –°—á—ë—Ç/–ª–∏–º–∏—Ç */
        function update() { if (discount < 0) discount = 0; if (discount > CAP) discount = CAP; dEl.textContent = discount.toFixed(1); }

        /* –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞–¥–µ–Ω–∏—è */
        function fallSetup(el, opts = {}) {
            const { allowEvade = true, allowSwim = true, size = 56 } = opts;
            el.style.left = rand(0, app.clientWidth - size) + 'px';

            if (Math.random() < 0.25) {
                el.style.setProperty('--rot', (Math.random() < 0.5 ? -1 : 1) * rand(120, 360) + 'deg');
            }

            const dur = rand(FALL_MIN, FALL_MAX);
            el.style.top = '-80px';
            el.style.setProperty('--fallDur', dur + 'ms');
            el.style.animation = 'fall ' + dur + 'ms linear forwards';
            el.addEventListener('animationend', () => el.remove(), { once: true });

            if (allowSwim && Math.random() < CH_SWIM) {
                const amp = 16 + Math.random() * 20, freq = 0.5 + Math.random() * 0.7, vel = (Math.random() < 0.5 ? -1 : 1) * (8 + Math.random() * 20);
                const x0 = parseFloat(el.style.left) || 0, start = performance.now();
                (function swim() {
                    if (!el.isConnected) return;
                    const t = (performance.now() - start) / 1000;
                    const nx = x0 + vel * t + amp * Math.sin(2 * Math.PI * freq * t);
                    el.style.left = clamp(nx, 0, app.clientWidth - size) + 'px';
                    el.__swim = requestAnimationFrame(swim);
                })();
                el.addEventListener('animationend', () => cancelAnimationFrame(el.__swim || 0), { once: true });
            }

            if (allowEvade) {
                const tryEvade = () => {
                    if (Math.random() < CH_EVADE) {
                        vibr(12);
                        const x = (parseFloat(el.style.left) || 0) + (Math.random() < 0.5 ? -1 : 1) * rand(110, 180);
                        el.style.left = clamp(x, 0, app.clientWidth - size) + 'px';
                    }
                };
                el.addEventListener('pointerdown', tryEvade);
                el.addEventListener('pointerenter', tryEvade);
            }

            app.appendChild(el);
        }

    /* –°–ø–∞–≤–Ω –∫–æ–≥–æ? */
    function spawn() {
        if (!running) return;
        const r = Math.random();

        // —Å—É–ø–µ—Ä-—Å–ª–æ–Ω (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω)
        if (!superDone && r < CH_SUPER) {
            superDone = true;
            spawnSuper();
            return;
        }

        // ‚Äî‚Äî‚Äî –ë–û–õ–¨–®–û–ô –°–õ–û–ù (–ú–∞–∫—Å–∏–º—É–º 3 –∑–∞ –∏–≥—Ä—É) ‚Äî‚Äî‚Äî
        if (bigCount < 5 && r < CH_SUPER + CH_BIG) {
            bigCount++;
            spawnBig();
            return;
        }
        // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî

        // –±–æ–º–±–∞
        if (r < CH_SUPER + CH_BIG + CH_BOMB) {
            spawnBomb();
            return;
        }

        // —Ç–æ—Ä–Ω–∞–¥–æ
        if (r < CH_SUPER + CH_BIG + CH_BOMB + CH_TORNADO) {
            spawnTornado();
            return;
        }

        // –æ–±—ã—á–Ω—ã–π —Å–ª–æ–Ω
        spawnNormal();
    }


        /* –°—É—â–Ω–æ—Å—Ç–∏ */
        function spawnNormal() {
            const el = makeElephantImg(); el.className = 'logo';
            fallSetup(el, { allowEvade: true, allowSwim: true, size: 56 });
            el.addEventListener('pointerdown', e => { playHit(); vibr(VIB_NORMAL); onHit(NORMAL, pct(NORMAL))(e); }, { once: true });
        }


      function spawnBig() {
            const el = makeBigElephantImg();
            el.className = 'big';

            fallSetup(el, { allowEvade: true, allowSwim: true, size: 90 });

            el.addEventListener('pointerdown', e => {
                playHit();
                vibr(VIB_NORMAL + 10);
                onHit(HIT_BIG, pct(HIT_BIG))(e);
            }, { once: true });
        }


        function makeBigElephantImg() {
                const el = new Image();
                el.src = LOGO_BIG;     // ‚Üê –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
                el.decoding = "async";
                el.loading = "eager";
                return el;
            }


        function spawnSuper() {
            const el = makeElephantImg(); el.className = 'super';
            fallSetup(el, { allowEvade: true, allowSwim: true, size: 56 });
            el.addEventListener('pointerdown', e => {
                playHit(); vibr(VIB_SUPER + CRIT_VIB);
                onHit(SUPER, pct(SUPER))(e);
                critCelebrate(e.clientX, e.clientY, '+' + pct(SUPER));
            }, { once: true });
        }

        function spawnBomb() {
            const el = document.createElement('div'); el.className = 'bomb'; el.textContent = BOMB_ICON;
            fallSetup(el, { allowEvade: false, allowSwim: true, size: 56 });
            el.addEventListener('pointerdown', e => { playBomb(); vibr(VIB_BOMB_V); boom(e.clientX, e.clientY); shake(); onHit(BOMB, '')(e); }, { once: true });
        }

        function spawnTornado() {
            const el = document.createElement('div'); el.className = 'tornado';
            // –ö–∞—Ä—Ç–∏–Ω–∫–∞ —Ç–æ—Ä–Ω–∞–¥–æ (–µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—É—Å—Ç–∞—è –∫—Ä—É—Ç—è—â–∞—è—Å—è ¬´–∞—É—Ä–∞¬ª)
            const img = new Image(); img.src = 'tornado.png'; img.style.width = '54px'; img.style.height = '54px'; img.style.pointerEvents = 'none';
            img.onerror = () => { img.remove(); }; // —Ç–∏—Ö–∏–π —Ñ—ç–π–ª
            el.appendChild(img);

            fallSetup(el, { allowEvade: true, allowSwim: true, size: 52 });
            el.addEventListener('pointerdown', e => {
                vibr(VIB_TORNADO);
                twistBurst(e.clientX, e.clientY, 10);
                vortex(e.clientX, e.clientY);
                windGust();
                pullNearby(e.clientX, e.clientY, { radius: 240, strength: 60, dur: 420 });
                onHit(HIT_TORNADO, '')(e);
            }, { once: true });
        }

        /* –ü—Ä–∏—Ç—è–≥–∏–≤–∞–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö —Å–ª–æ–Ω–æ–≤ –∫ —Ç–æ—á–∫–µ (x,y) */
        function pullNearby(x, y, { radius = 220, strength = 120, dur = 360 } = {}) {
            const start = performance.now();
            const elems = Array.from(document.querySelectorAll('.logo,.super,.big'));
            const meta = elems.map(el => {
                const r = el.getBoundingClientRect();
                return { el, w: r.width, h: r.height };
            });

            function step(now) {
                const t = Math.min(1, (now - start) / dur);
                const ease = t < .5 ? (2 * t * t) : (-1 + (4 - 2 * t) * t); // ease-in-out
                meta.forEach(({ el, w, h }) => {
                    if (!el.isConnected) return;
                    const r = el.getBoundingClientRect();
                    const cx = r.left + r.width / 2, cy = r.top + r.height / 2;
                    const dx = x - cx, dy = y - cy, dist = Math.hypot(dx, dy);
                    if (dist > radius) return;

                    const k = (1 - dist / radius) * strength * ease;
                    const curLeft = parseFloat(el.style.left) || 0;
                    const nx = curLeft + (dx / (dist || 1)) * k;
                    el.style.left = clamp(nx, 0, app.clientWidth - w) + 'px';

                    const curRot = parseFloat(getComputedStyle(el).getPropertyValue('--rot')) || 0;
                    el.style.setProperty('--rot', (curRot + (dx > 0 ? 8 : -8) * ease) + 'deg');
                });
                if (t < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        /* –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è */
        function onHit(delta, label) {
            return e => {
                if (!running) return;
                discount += delta; update();
                const p = e ? { x: e.clientX, y: e.clientY } : { x: 0, y: 0 };
                if (delta > 0) celebrate(p.x, p.y, '+' + label);
                e.currentTarget.remove();
            };
        }

        /* –¢–∞–π–º–µ—Ä –∏ —Ä–∞—É–Ω–¥—ã */
        function tick(now) {
            const left = (GAME_DURATION - (now - t0)) / 1000;
            tEl.textContent = Math.max(0, left).toFixed(1);
            if (left > 0) requestAnimationFrame(tick); else endGame();
        }

        function clearField() {
            document.querySelectorAll('.logo,.super,.big,.tornado,.bomb,.sheet,.ring,.confetti,.float,.boom,.crit-flash,.crit-burst,.crit-ray,.twist,.vortex').forEach(n => n.remove());
        }

        function startGame() {
            running = false; if (spawnTimer) clearInterval(spawnTimer);
            clearField(); discount = 0; superDone = false; bigCount = 0; update();
            startOv.style.display = 'none';

            running = true; t0 = performance.now();
            spawnTimer = setInterval(spawn, SPAWN_INTERVAL);
            requestAnimationFrame(tick);
        }

        function endGame() {
            running = false; clearInterval(spawnTimer);
            const final = Math.round(discount);
            const code = 'ELEPHANT-' + String(final).padStart(2, '0') + '-' + Math.random().toString(36).slice(2, 6).toUpperCase();
            const s = document.createElement('div'); s.className = 'sheet';
            s.innerHTML = '<div style="text-align:center;">'
                + '<h2>Koniec!</h2>'
                + '<p>Tw√≥j rabat: <b>' + final + '%</b></p>'
                + '<div class="coupon"><span>' + code + '</span> <button class="btn" id="copy">Kopiuj</button></div>'
                + '<p style="opacity:.9;margin-top:12px">Zr√≥b zrzut ekranu i <b>wy≈õlij nam w wiadomo≈õci</b>.</p>'
                + '<br><button class="btn" id="again">Jeszcze raz</button>'
                + '</div>';
            document.body.appendChild(s);

            const copy = s.querySelector('#copy');
            copy.onclick = async () => {
                try { await navigator.clipboard.writeText(code); alert('Skopiowano ‚úÖ'); }
                catch {
                    const ta = document.createElement('textarea'); ta.value = code; document.body.appendChild(ta);
                    ta.select(); document.execCommand('copy'); ta.remove(); alert('Skopiowano ‚úÖ');
                }
            };
            s.querySelector('#again').onclick = () => { s.remove(); startOv.style.display = 'flex'; };
        }

        /* –°—Ç–∞—Ä—Ç */
        document.getElementById('start').addEventListener('pointerdown', () => {
            bgMusic.currentTime = 0; bgMusic.play().catch(() => { });
            startGame();
        });
    </script>
</body>

</html>